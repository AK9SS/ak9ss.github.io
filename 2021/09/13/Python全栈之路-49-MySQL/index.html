<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Python全栈之路-49-MySQL"><meta name="keywords" content=""><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><title>Python全栈之路-49-MySQL | Hexo</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8A%E6%97%A5%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9"><span class="toc-number">1.</span> <span class="toc-text">今日主要内容</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="toc-number">1.1.1.</span> <span class="toc-text">为什么要用视图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE"><span class="toc-number">1.1.2.</span> <span class="toc-text">如何创建视图</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">基本的语法结构</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.3.</span> <span class="toc-text">事务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.3.1.</span> <span class="toc-text">事务的作用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%9B%9B%E5%A4%A7%E7%89%B9%E6%80%A7"><span class="toc-number">1.3.2.</span> <span class="toc-text">事务四大特性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.3.3.</span> <span class="toc-text">如何使用事务</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.1.</span> <span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pymsql%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.2.</span> <span class="toc-text">pymsql调用存储过程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="toc-number">1.5.</span> <span class="toc-text">内置函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">1.6.</span> <span class="toc-text">流程控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95"><span class="toc-number">1.7.</span> <span class="toc-text">索引</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%9A%E9%9B%86%E7%B4%A2%E5%BC%95"><span class="toc-number">1.7.1.</span> <span class="toc-text">聚集索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95"><span class="toc-number">1.7.2.</span> <span class="toc-text">辅助索引</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95"><span class="toc-number">1.7.3.</span> <span class="toc-text">覆盖索引</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">John Doe</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">13</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Hexo</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right"></span></div><div id="post-info"><div id="post-title">Python全栈之路-49-MySQL</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-13</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h3 id="今日主要内容"><a href="#今日主要内容" class="headerlink" title="今日主要内容"></a>今日主要内容</h3><ul>
<li>视图</li>
<li>触发器</li>
<li>事务</li>
<li>存储过程</li>
<li>内置函数</li>
<li>流程控制</li>
<li>索引</li>
</ul>
<h4 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h4><p>视图就是通过查询得到一张虚拟表，然后保存下来，下次可以直接使用，其实视图就是一张表。一般情况下视图的使用频率并不高，当创建了很多视图之后，会造成表的不好维护性。</p>
<h5 id="为什么要用视图"><a href="#为什么要用视图" class="headerlink" title="为什么要用视图"></a>为什么要用视图</h5><p>如果要频繁的操作一张虚拟表（拼表组成的），就可以制作成视图，后续便于使用。</p>
<h5 id="如何创建视图"><a href="#如何创建视图" class="headerlink" title="如何创建视图"></a>如何创建视图</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 固定语法</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> 视图名 <span class="keyword">as</span> 虚拟表的查询<span class="keyword">sql</span>语句</span><br><span class="line"></span><br><span class="line"># 具体操作</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">view</span> HAHA <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">inner</span> <span class="keyword">join</span> dep <span class="keyword">on</span> emp.did <span class="operator">=</span> dep.id;</span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong></p>
<ol>
<li>创建视图在硬盘上只会有表结构，没有表数据，数据并没有存在于硬盘，数据还是来自于之前的表；</li>
<li>视图一般只用来查询，里面的数据不要进行修改，可能会影响真正的表数据；</li>
</ol>
<h4 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h4><p>在满足对表数据进行增、删、改的情况下，自动触发的功能。使用触发器可以帮助我们实现监控、日志、自动处理异常等等…</p>
<p>触发器可以在六种情况下自动触发，增前、增后、删前、删后、改前、改后。</p>
<h5 id="基本的语法结构"><a href="#基本的语法结构" class="headerlink" title="基本的语法结构"></a>基本的语法结构</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"># 具体使用，针对触发器的名字，我们通常需要做到见名知意思。</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> 触发器名字 before<span class="operator">/</span>after <span class="keyword">insert</span><span class="operator">/</span>update<span class="operator">/</span><span class="keyword">delete</span> <span class="keyword">on</span> 表名</span><br><span class="line">  <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">sql</span>语句</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ps:修改MySQL默认的语句结束符，只能用于当前窗口</span></span><br><span class="line"><span class="comment">--    delimiter $$ 将默认的结束符号有;改为$$</span></span><br><span class="line"></span><br><span class="line"># 案例: 当cmd表中记录succes字段是<span class="keyword">no</span>那么就触发触发器的执行去errlog表中插入数据</span><br><span class="line"># 准备表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> cmd(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  <span class="keyword">user</span> <span class="type">char</span>(<span class="number">32</span>),</span><br><span class="line">  priv <span class="type">char</span>(<span class="number">10</span>),</span><br><span class="line">  cmd <span class="type">char</span>(<span class="number">64</span>),</span><br><span class="line">  sub_time datetime,</span><br><span class="line">  success enum(<span class="string">&#x27;yes&#x27;</span>, <span class="string">&#x27;no&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> errlog(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  err_cmd <span class="type">char</span>(<span class="number">64</span>),</span><br><span class="line">  err_time datetime</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 创建触发器并修改结束符</span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> tri_after_insert_cmd after <span class="keyword">insert</span> <span class="keyword">on</span> cmd</span><br><span class="line">  <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    if NEW.success <span class="operator">=</span> <span class="string">&#x27;no&#x27;</span> <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">insert</span> <span class="keyword">into</span> errlog(err_cmd, err_time) <span class="keyword">values</span>(NEW.cmd, NEW.sub_time);</span><br><span class="line">    <span class="keyword">end</span> if;</span><br><span class="line">  <span class="keyword">end</span>$$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"># 插入测试数据</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> cmd(</span><br><span class="line">  <span class="keyword">user</span>,</span><br><span class="line">  priv,</span><br><span class="line">  cmd,</span><br><span class="line">  sub_time,</span><br><span class="line">  success</span><br><span class="line">)</span><br><span class="line"><span class="keyword">values</span></span><br><span class="line">  (<span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;0755&#x27;</span>, <span class="string">&#x27;ls -l /etc&#x27;</span>, NOW(), <span class="string">&#x27;yes&#x27;</span>),</span><br><span class="line">  (<span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;0755&#x27;</span>, <span class="string">&#x27;cat /etc/passwd&#x27;</span>, NOW(), <span class="string">&#x27;no&#x27;</span>),</span><br><span class="line">  (<span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;0755&#x27;</span>, <span class="string">&#x27;useradd xxx&#x27;</span>, NOW(), <span class="string">&#x27;no&#x27;</span>),</span><br><span class="line">  (<span class="string">&#x27;jason&#x27;</span>, <span class="string">&#x27;0755&#x27;</span>, <span class="string">&#x27;ps aux&#x27;</span>, NOW(), <span class="string">&#x27;yes&#x27;</span>);</span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> cmd;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+------+-----------------+---------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> <span class="keyword">user</span>  <span class="operator">|</span> priv <span class="operator">|</span> cmd             <span class="operator">|</span> sub_time            <span class="operator">|</span> success <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+------+-----------------+---------------------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> jason <span class="operator">|</span> <span class="number">0755</span> <span class="operator">|</span> ls <span class="operator">-</span>l <span class="operator">/</span>etc      <span class="operator">|</span> <span class="number">2021</span><span class="number">-09</span><span class="number">-13</span> <span class="number">22</span>:<span class="number">26</span>:<span class="number">54</span> <span class="operator">|</span> yes     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> jason <span class="operator">|</span> <span class="number">0755</span> <span class="operator">|</span> cat <span class="operator">/</span>etc<span class="operator">/</span>passwd <span class="operator">|</span> <span class="number">2021</span><span class="number">-09</span><span class="number">-13</span> <span class="number">22</span>:<span class="number">26</span>:<span class="number">54</span> <span class="operator">|</span> <span class="keyword">no</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> jason <span class="operator">|</span> <span class="number">0755</span> <span class="operator">|</span> useradd xxx     <span class="operator">|</span> <span class="number">2021</span><span class="number">-09</span><span class="number">-13</span> <span class="number">22</span>:<span class="number">26</span>:<span class="number">54</span> <span class="operator">|</span> <span class="keyword">no</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> jason <span class="operator">|</span> <span class="number">0755</span> <span class="operator">|</span> ps aux          <span class="operator">|</span> <span class="number">2021</span><span class="number">-09</span><span class="number">-13</span> <span class="number">22</span>:<span class="number">26</span>:<span class="number">54</span> <span class="operator">|</span> yes     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+------+-----------------+---------------------+---------+</span></span><br><span class="line"><span class="number">4</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.10</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> errlog;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> err_cmd         <span class="operator">|</span> err_time            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> cat <span class="operator">/</span>etc<span class="operator">/</span>passwd <span class="operator">|</span> <span class="number">2021</span><span class="number">-09</span><span class="number">-13</span> <span class="number">22</span>:<span class="number">26</span>:<span class="number">54</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> useradd xxx     <span class="operator">|</span> <span class="number">2021</span><span class="number">-09</span><span class="number">-13</span> <span class="number">22</span>:<span class="number">26</span>:<span class="number">54</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-----------------+---------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.12</span> sec)</span><br><span class="line"></span><br><span class="line"># 删除触发器</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">drop</span> <span class="keyword">trigger</span> tri_after_insert_cmd;</span><br></pre></td></tr></table></figure>

<h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><p>开启一个事务可以包含多条sql语句，这些sql语句要么同时成功，要么都不成功，称之为事务的原子性</p>
<h5 id="事务的作用"><a href="#事务的作用" class="headerlink" title="事务的作用"></a>事务的作用</h5><p>保证了对数据操作的安全性，比如有人像你的银行卡中打款1亿元，第一步打款人的银行卡要减1亿元，你的银行卡中要加一亿元，其中一步必须全部成功，才算成功。 在真是环境中，以上的例子可能不会每次都是成功，所以在操作多条数据的时候可能会出现某几条操作不成功的情况。</p>
<h5 id="事务四大特性"><a href="#事务四大特性" class="headerlink" title="事务四大特性"></a>事务四大特性</h5><p><strong>简称：ACID</strong></p>
<p>A：原子性</p>
<p>一个事务是一个不可分割的单位，事务中包含的诸多操作，要么同时成功要么同时失败。</p>
<p>C：一致性</p>
<p>事务必须是使数据从一个一致性的状态变到另外一个一致性的状态，一致性跟原子性是密切相关的</p>
<p>I：隔离性</p>
<p>一个事务的执行不能被其他事务干扰（即一个事务内部的操作及使用到的数据对并发的其他事务是隔离的，并发执行的事务之间也是互相不干扰的。）</p>
<p>D：持久性。</p>
<p>也叫“永久性”，一个事务一旦提交成功执行成功，那么它对数据库中数据的修改应该是永久的，接下来的其他操作或者是故障不应该对其有任何的影响。</p>
<h5 id="如何使用事务"><a href="#如何使用事务" class="headerlink" title="如何使用事务"></a>如何使用事务</h5><ol>
<li>开启事务（start transaction）</li>
<li>回滚，回到事务执行之前的状态（rollback）</li>
<li>确认，确认之后就无法回滚了（commit）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"># 模拟转账功能</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">  name <span class="type">char</span>(<span class="number">16</span>),</span><br><span class="line">  balance <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span>(name, balance) <span class="keyword">values</span></span><br><span class="line">  (<span class="string">&#x27;jason&#x27;</span>, <span class="number">1000</span>),</span><br><span class="line">  (<span class="string">&#x27;egon&#x27;</span>, <span class="number">1000</span>),</span><br><span class="line">  (<span class="string">&#x27;tank&#x27;</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"># 开启事务</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">start</span> transaction;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"># 更新数据</span><br><span class="line">update <span class="keyword">user</span> <span class="keyword">set</span> balance<span class="operator">=</span><span class="number">900</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;jason&#x27;</span>;</span><br><span class="line">update <span class="keyword">user</span> <span class="keyword">set</span> balance<span class="operator">=</span><span class="number">1010</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;egon&#x27;</span>;</span><br><span class="line">update <span class="keyword">user</span> <span class="keyword">set</span> balance<span class="operator">=</span><span class="number">1090</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;tank&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name  <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> jason <span class="operator">|</span>     <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> egon  <span class="operator">|</span>    <span class="number">1010</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> tank  <span class="operator">|</span>    <span class="number">1090</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.04</span> sec)</span><br><span class="line"></span><br><span class="line"># 不想生效就回退</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">rollback</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name  <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> jason <span class="operator">|</span>    <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> egon  <span class="operator">|</span>    <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> tank  <span class="operator">|</span>    <span class="number">1000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.08</span> sec)</span><br><span class="line"></span><br><span class="line"># 在此修改数据，并执行确认操作。</span><br><span class="line">update <span class="keyword">user</span> <span class="keyword">set</span> balance<span class="operator">=</span><span class="number">900</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;jason&#x27;</span>;</span><br><span class="line">update <span class="keyword">user</span> <span class="keyword">set</span> balance<span class="operator">=</span><span class="number">1010</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;egon&#x27;</span>;</span><br><span class="line">update <span class="keyword">user</span> <span class="keyword">set</span> balance<span class="operator">=</span><span class="number">1090</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;tank&#x27;</span>;</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name  <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> jason <span class="operator">|</span>     <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> egon  <span class="operator">|</span>    <span class="number">1010</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> tank  <span class="operator">|</span>    <span class="number">1090</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.08</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">commit</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">rollback</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> name  <span class="operator">|</span> balance <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> jason <span class="operator">|</span>     <span class="number">900</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> egon  <span class="operator">|</span>    <span class="number">1010</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> tank  <span class="operator">|</span>    <span class="number">1090</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.04</span> sec)</span><br></pre></td></tr></table></figure>

<h4 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h4><p>存储过程就类似于Python中的自定义函数，它的内部包含了一系列可以执行的sql语句，存储过程存放于MySQL服务端中，可以直接通过调用存储过程触发内部sql语句的执行。</p>
<h5 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"># 基本范式</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名称(形参<span class="number">1</span>, 形参<span class="number">2</span>, ....)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">sql</span>代码</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line"><span class="keyword">call</span> 存储过程名称();</span><br><span class="line"></span><br><span class="line">#实际使用</span><br><span class="line">mysql<span class="operator">&gt;</span> delimiter $$</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">procedure</span> p1(</span><br><span class="line">	<span class="keyword">in</span> m <span class="type">int</span>,  #只进不出，m不能返回。</span><br><span class="line">  <span class="keyword">in</span> n <span class="type">int</span>,</span><br><span class="line">  <span class="keyword">out</span> res <span class="type">int</span> #该形参可以直接返回</span><br><span class="line">)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> cmd <span class="keyword">where</span> id<span class="operator">&gt;</span>m <span class="keyword">and</span> id<span class="operator">&lt;</span>n;</span><br><span class="line">    <span class="keyword">set</span> res<span class="operator">=</span><span class="number">666</span>;</span><br><span class="line"><span class="keyword">end</span>$$</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> delimiter ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 针对形参res，不能直接传数据，需要传一个变量名，否则会报错。</span></span><br><span class="line"># 定义变量</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">set</span> <span class="variable">@ret</span><span class="operator">=</span><span class="number">10</span>;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"># 查看变量</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="variable">@ret</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> <span class="variable">@ret</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>   <span class="number">10</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.07</span> sec)</span><br><span class="line"></span><br><span class="line"># 调用存储过程</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">call</span> p1(<span class="number">1</span>, <span class="number">5</span>, <span class="variable">@ret</span>);</span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+------+-----------------+---------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> <span class="keyword">user</span>  <span class="operator">|</span> priv <span class="operator">|</span> cmd             <span class="operator">|</span> sub_time            <span class="operator">|</span> success <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+------+-----------------+---------------------+---------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> jason <span class="operator">|</span> <span class="number">0755</span> <span class="operator">|</span> cat <span class="operator">/</span>etc<span class="operator">/</span>passwd <span class="operator">|</span> <span class="number">2021</span><span class="number">-09</span><span class="number">-13</span> <span class="number">22</span>:<span class="number">26</span>:<span class="number">54</span> <span class="operator">|</span> <span class="keyword">no</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> jason <span class="operator">|</span> <span class="number">0755</span> <span class="operator">|</span> useradd xxx     <span class="operator">|</span> <span class="number">2021</span><span class="number">-09</span><span class="number">-13</span> <span class="number">22</span>:<span class="number">26</span>:<span class="number">54</span> <span class="operator">|</span> <span class="keyword">no</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> jason <span class="operator">|</span> <span class="number">0755</span> <span class="operator">|</span> ps aux          <span class="operator">|</span> <span class="number">2021</span><span class="number">-09</span><span class="number">-13</span> <span class="number">22</span>:<span class="number">26</span>:<span class="number">54</span> <span class="operator">|</span> yes     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+------+-----------------+---------------------+---------+</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.08</span> sec)</span><br><span class="line"></span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="variable">@ret</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> <span class="variable">@ret</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">666</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.08</span> sec)</span><br></pre></td></tr></table></figure>

<h5 id="pymsql调用存储过程"><a href="#pymsql调用存储过程" class="headerlink" title="pymsql调用存储过程"></a>pymsql调用存储过程</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">conn = pymysql.connect(</span><br><span class="line">    host=<span class="string">&#x27;192.168.100.129&#x27;</span>,</span><br><span class="line">    port=<span class="number">3306</span>,</span><br><span class="line">    user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    password=<span class="string">&#x27;!QAZ2wsx&#x27;</span>,</span><br><span class="line">    database=<span class="string">&#x27;day49&#x27;</span>,</span><br><span class="line">    charset=<span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">cursor = conn.cursor(cursor=pymysql.cursors.DictCursor)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用存储过程</span></span><br><span class="line"><span class="comment"># 因为pymysql在封装的时候把参数传递进去是使用@_p1_0=1...这种方式的，所以就省略定义变量的过程。</span></span><br><span class="line">cursor.callproc(<span class="string">&quot;p1&quot;</span>, (<span class="number">1</span>, <span class="number">3</span>, <span class="number">10</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cursor.fetchall())</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[&#123;&#x27;id&#x27;: 2, &#x27;user&#x27;: &#x27;jason&#x27;, &#x27;priv&#x27;: &#x27;0755&#x27;, &#x27;cmd&#x27;: &#x27;cat /etc/passwd&#x27;, &#x27;sub_time&#x27;: datetime.datetime(2021, 9, 13, 22, 26, 54), &#x27;success&#x27;: &#x27;no&#x27;&#125;]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h4><p>跟存储过程是有区别的，存储过程是自定义函数，函数就是MySQL定义的函数。</p>
<h4 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h4><ul>
<li>if</li>
<li>while</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># if判断</span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc_if ()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">declare</span> i <span class="type">int</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">    if i <span class="operator">=</span> <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">    	<span class="keyword">select</span> <span class="number">1</span>;</span><br><span class="line">    elseif i <span class="operator">=</span> <span class="number">2</span> <span class="keyword">then</span></span><br><span class="line">    	<span class="keyword">select</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    	<span class="keyword">select</span> <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">end</span>$$</span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># while循环</span><br><span class="line">delimiter $$</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> proc_while()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">declare</span> num <span class="type">int</span>;</span><br><span class="line">    <span class="keyword">set</span> num<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">    while num <span class="operator">&lt;</span> <span class="number">10</span> do</span><br><span class="line">    	<span class="keyword">select</span> num;</span><br><span class="line">        <span class="keyword">set</span> num <span class="operator">=</span> num <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">   	<span class="keyword">end</span> while;</span><br><span class="line"><span class="keyword">end</span>$$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>

<h4 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h4><blockquote>
<p>ps:数据都是存在硬盘上，查询数据不可避免的需要IO操作</p>
</blockquote>
<p>索引就是一种数据结构，类似书的目录，意味着以后在查询数据的时候应该先找目录再找数据，而不是一页一页的翻书，从而提升查询速度，降低IO操作。</p>
<p>索引在MySQL中也叫“键”，是存储引擎用于快速查找记录的一种数据结构。</p>
<ul>
<li>primary key</li>
<li>unique key</li>
<li>index key</li>
</ul>
<p>以上三种，前两种除可以增加查询速度还可以具有约束条件，最后一种没有任何的约束条件，只是用来帮助快速查询数据。索引的本质其实就是，<em>通过不断的缩小想要的数据范围筛选出最终的结果，同时将随机事件变成顺序事件，也就是说有了索引机制，我们可以总是用一种固定的方式查找数据。</em></p>
<h5 id="聚集索引"><a href="#聚集索引" class="headerlink" title="聚集索引"></a>聚集索引</h5><p>聚集索引指的就是主键</p>
<ol>
<li>Innodb只有两个文件，直接将主键存放在了idb表中</li>
<li>MyIsam 三个文件，单独将索引存在一个文件中</li>
</ol>
<h5 id="辅助索引"><a href="#辅助索引" class="headerlink" title="辅助索引"></a>辅助索引</h5><p>查询数据的时候不能一直使用到主键，也有可能会用到name，password等其他字段，那么这个时候是没有办法里利用聚集索引，可以根据情况给其他字段设置辅助索引（也是一个b+树）</p>
<p><em>辅助索引的叶子节点，存放的是数据对应的主键值，先按照辅助索引拿到数据的主键值，之后在按照拿到的主键值在到主键的聚集索引中查询数据。</em></p>
<h5 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h5><p>在辅助索引的叶子节点就已经拿到了需要的数据，比如以下示例。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 覆盖索引</span><br><span class="line"><span class="comment">-- 命中了索引字段并且索要数据就是索引字段，就是覆盖索引。</span></span><br><span class="line"><span class="keyword">select</span> name <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;jason&#x27;</span>;</span><br><span class="line"></span><br><span class="line"># 非覆盖索引</span><br><span class="line"><span class="comment">-- 命中率索引字段但是并非是要索引字段，就是非覆盖索引。</span></span><br><span class="line"><span class="keyword">select</span> age <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;jason&#x27;</span>;</span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/09/13/Python全栈之路-49-MySQL/">http://example.com/2021/09/13/Python全栈之路-49-MySQL/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/09/15/Python%E5%85%A8%E6%A0%88%E4%B9%8B%E8%B7%AF-50-HTML/"><i class="fa fa-chevron-left">  </i><span>Python全栈之路-50-HTML</span></a></div><div class="next-post pull-right"><a href="/2021/09/11/Python%E5%85%A8%E6%A0%88%E4%B9%8B%E8%B7%AF-48-MySQL/"><span>Python全栈之路-48-MySQL</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By John Doe</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>